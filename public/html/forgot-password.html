<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title data-translate-key="forgotPasswordTitle">Şifremi Unuttum</title>
    <link rel="stylesheet" href="/css/stylegeneral.css">
    <link rel="stylesheet" href="/css/auth.css">
</head>
<body>
    <header>
        <div class="left"><h1 data-translate-key="mainTitle">İstanbul Müzeleri</h1></div>
        <div class="right">
            <div id="language-switcher">
                <button id="lang-tr">TR</button>
                <button id="lang-en">EN</button>
            </div>
        </div>
    </header>

    <div class="auth-container">
        <div class="auth-content"> 
            <h1 data-translate-key="forgotPasswordTitle">Şifre Sıfırlama</h1>
            <p style="text-align: center; color: #ccc; margin-bottom: 20px; font-size: 0.9rem;" data-translate-key="forgotPasswordDesc">
                Kayıtlı e-posta adresinizi girin, size bir sıfırlama linki gönderelim.
            </p>
            <form id="forgotPasswordForm">
                <input type="email" id="email" data-translate-key="emailPlaceholder" placeholder="E-posta Adresiniz" required>
                <button type="submit" id="submitBtn" data-translate-key="sendResetLinkBtn">Sıfırlama Linki Gönder</button>
            </form>
            <div id="message" style="margin-top: 15px; text-align: center; font-size: 0.85rem;"></div>
        </div>
        <p class="switch-auth-link">
            <a href="/html/login.html" data-translate-key="backToLogin">Giriş Sayfasına Dön</a>
        </p>
    </div>

    <div class="auth-slideshow-full">
        <div id="slideshow-bg-next" class="slide-img" style="opacity: 0;"></div>
        <div id="slideshow-bg" class="slide-img"></div>
        <div class="slide-overlay"></div>
    </div>

    <footer class="auth-footer">
        <p data-translate-key="copyrightNotice">© 2025 Dijital Müzeler. Her Hakkı Saklıdır.</p>
    </footer>

    <script src="/scripts/translations.js"></script>
    <script src="/scripts/language.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const forgotForm = document.getElementById('forgotPasswordForm');
            const msgDiv = document.getElementById('message');
            const btn = document.getElementById('submitBtn');

            // --- 1. ŞİFRE UNUTTUM İŞLEMİ ---
            if (forgotForm) {
                forgotForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('email').value;

                    btn.disabled = true;
                    // Yükleniyor durumunu dil desteğine göre ayarla
                    const originalText = btn.innerText;
                    btn.innerText = "...";

                    try {
                        const res = await fetch('/api/forgot-password', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ email })
                        });
                        const data = await res.json();

                        if (res.ok) {
                            msgDiv.style.color = "var(--accent-color)"; // Altın sarısı tonun
                            msgDiv.innerText = data.message || (window.currentLang === 'tr' ? "Sıfırlama linki gönderildi!" : "Reset link sent!");
                        } else {
                            msgDiv.style.color = "#ff4d4d"; 
                            msgDiv.innerText = data.message;
                        }
                    } catch (err) {
                        msgDiv.style.color = "#ff4d4d";
                        msgDiv.innerText = translations[window.currentLang]?.serverError || "Bir hata oluştu.";
                    } finally {
                        btn.disabled = false;
                        btn.innerText = translations[window.currentLang]?.sendResetLinkBtn || originalText;
                    }
                });
            }

            // --- 2. SLIDESHOW BAŞLAT ---
            initForgotSlideshow();
        });

        async function initForgotSlideshow() {
            const currentBg = document.getElementById('slideshow-bg');
            const nextBg = document.getElementById('slideshow-bg-next');
            if (!currentBg || !nextBg) return;

            try {
                const res = await fetch('/api/museum');
                let museums = await res.json();
                if (!museums || museums.length === 0) return;

                // Rastgele karıştırma
                museums = [...museums].sort(() => Math.random() - 0.5);
                const getPath = (m) => m.imageUrl || m.image || "";

                let i = 0;
                currentBg.style.backgroundImage = `url('${getPath(museums[i])}')`;
                currentBg.style.opacity = "1";

                const update = () => {
                    let nextIndex = (i + 1) % museums.length;
                    const nextImgPath = getPath(museums[nextIndex]);

                    nextBg.style.backgroundImage = `url('${nextImgPath}')`;
                    nextBg.style.opacity = "1";
                    currentBg.style.opacity = "0";

                    setTimeout(() => {
                        currentBg.style.transition = "none"; 
                        currentBg.style.backgroundImage = `url('${nextImgPath}')`;
                        currentBg.style.opacity = "1"; 
                        i = nextIndex;
                        setTimeout(() => {
                            currentBg.style.transition = "opacity 1.5s ease-in-out";
                        }, 50);
                    }, 1500); 
                };

                setInterval(update, 5000);
            } catch (e) {
                console.warn("Slideshow hatası:", e);
            }
        }
    </script>
</body>
</html>